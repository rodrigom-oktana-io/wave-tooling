{
  "Extract_PricebookEntry": {
    "action": "sfdcDigest",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "fields": [
        {
          "name": "Id"
        },
        {
          "name": "Product2Id"
        }
      ],
      "object": "PricebookEntry"
    }
  },
  "Join_CaseAccount": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "compute_CalculatedCaseDuration",
      "left_key": [
        "AccountId"
      ],
      "right_select": [
        "Name",
        "Type",
        "Industry",
        "BillingCountry",
        "BillingState",
        "AccountSource",
        "NumberOfEmployees",
        "AnnualRevenue",
        "OwnerId",
        "Owner.Name",
        "Owner.UserManager.Name",
        "Owner.UserManagerNames",
        "Owner.UserManager.UniqueUserName",
        "Owner.UniqueUserName",
        "Owner.Role.Name",
        "Owner.Role.Roles",
        "Owner.Role.RolePath",
        "Owner.Role.ParentRoleId"
      ],
      "right": "Join_AccountOwner",
      "relationship": "Account"
    }
  },
  "Extract_Opportunity": {
    "action": "sfdcDigest",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "fields": [
        {
          "name": "Id"
        },
        {
          "name": "AccountId"
        },
        {
          "name": "OwnerId"
        },
        {
          "name": "Name"
        },
        {
          "name": "StageName"
        },
        {
          "name": "LeadSource"
        },
        {
          "name": "IsWon"
        },
        {
          "name": "Type"
        },
        {
          "name": "IsClosed"
        },
        {
          "name": "ForecastCategory"
        },
        {
          "name": "ForecastCategoryName"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "CreatedDate__c"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "CloseDate"
        },
        {
          "name": "Amount"
        },
        {
          "name": "CreatedById"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "LastModifiedDate"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "LastActivityDate__c"
        },
        {
          "name": "HasOpportunityLineItem"
        },
        {
          "name": "RecordTypeId"
        }
      ],
      "object": "Opportunity"
    }
  },
  "add_standard_Extract_Opportunity": {
    "action": "computeExpression",
    "parameters": {
      "source": "Extract_Opportunity",
      "computedFields": [
        {
          "name": "CreatedDate",
          "type": "Date",
          "label": "CreatedDate",
          "saqlExpression": "CreatedDate__c",
          "default": ""
        },
        {
          "name": "LastActivityDate",
          "type": "Date",
          "label": "LastActivity",
          "saqlExpression": "LastActivityDate__c",
          "default": ""
        }
      ],
      "mergeWithSource": true
    }
  },
  "drop_custom_Extract_Opportunity": {
    "action": "sliceDataset",
    "parameters": {
      "source": "add_standard_Extract_Opportunity",
      "mode": "drop",
      "fields": [
        {
          "name": "CreatedDate__c"
        },
        {
          "name": "LastActivityDate__c"
        }
      ]
    }
  },
  "Extract_OpportunityAmount": {
    "action": "sfdcDigest",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "fields": [
        {
          "name": "Id"
        },
        {
          "name": "Amount"
        }
      ],
      "object": "Opportunity"
    }
  },
  "Join_LeadOwner": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Compute_CurrentDateForLeads",
      "left_key": [
        "OwnerId"
      ],
      "right_select": [
        "Name",
        "Username",
        "UserRoleId",
        "UserManager.Name",
        "UserManagerNames",
        "UniqueUserName",
        "UserManager.UniqueUserName",
        "Role.Name",
        "Role.DeveloperName",
        "Role.Roles",
        "Role.RolePath",
        "Role.ParentRoleId",
        "Role.ParentRole.Name",
        "Role.ParentRole.DeveloperName",
        "Role.RoleNames",
        "Role.RoleNamesPath"
      ],
      "right": "User_with_Roles",
      "relationship": "Owner"
    }
  },
  "Extract_Product": {
    "action": "sfdcDigest",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "fields": [
        {
          "name": "Id"
        },
        {
          "name": "ProductCode"
        },
        {
          "name": "Name"
        },
        {
          "name": "Family"
        }
      ],
      "object": "Product2"
    }
  },
  "Join_LeadOwnerOpportunity": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Compute_Lead_Name_or_Queue",
      "left_key": [
        "ConvertedOpportunityId"
      ],
      "right_select": [
        "Name",
        "StageName",
        "CloseDate",
        "IsWon",
        "Type",
        "IsClosed",
        "LeadSource",
        "ForecastCategory",
        "ForecastCategoryName",
        "CreatedDate",
        "AccountId",
        "OwnerId",
        "Owner.Name",
        "Owner.UserManager.Name",
        "Owner.UserManagerNames",
        "Owner.UserManager.UniqueUserName",
        "Owner.UniqueUserName",
        "Owner.Role.Name",
        "Owner.Role.DeveloperName",
        "Owner.Role.Roles",
        "Owner.Role.RolePath",
        "Owner.Role.ParentRoleId",
        "OpportunityAge",
        "DaysSinceLastActivity"
      ],
      "right": "Join_OpportunityOwner",
      "relationship": "ConvertedOpportunity"
    }
  },
  "Join_User_Manager": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "ManagerId"
      ],
      "left": "Compute_Manager_Unique",
      "left_key": [
        "Id"
      ],
      "right_select": [
        "Name",
        "Username",
        "UserRoleId",
        "Id",
        "UniqueUserName"
      ],
      "right": "Compute_Manager_Unique",
      "relationship": "UserManager"
    }
  },
  "Compute_CurrentDateForLeads": {
    "action": "computeExpression",
    "parameters": {
      "source": "drop_custom_Extract_Lead",
      "computedFields": [
        {
          "format": "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'",
          "name": "CurrentDate",
          "saqlExpression": "now()",
          "label": "CurrentDate",
          "type": "Date"
        }
      ],
      "mergeWithSource": true
    }
  },
  "Extract_User": {
    "action": "sfdcDigest",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "fields": [
        {
          "name": "Id"
        },
        {
          "name": "Username"
        },
        {
          "name": "Name"
        },
        {
          "name": "FirstName"
        },
        {
          "name": "LastName"
        },
        {
          "name": "UserRoleId"
        },
        {
          "name": "UserType"
        },
        {
          "name": "IsActive"
        },
        {
          "defaultValue": "N/A",
          "name": "ManagerId"
        }
      ],
      "object": "User"
    }
  },
  "Join_ActivityOwner_Product_Opp_User": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Join_ActivityOwner_Product_Opp",
      "left_key": [
        "OwnerId"
      ],
      "right_select": [
        "Name"
      ],
      "right": "Flatten_UserManager",
      "relationship": "AssignedTo"
    }
  },
  "Extract_Case": {
    "action": "sfdcDigest",
    "parameters": {
      "fields": [
        {
          "name": "AccountId"
        },
        {
          "name": "ContactId"
        },
        {
          "name": "OwnerId"
        },
        {
          "name": "Id"
        },
        {
          "name": "IsClosed"
        },
        {
          "name": "Origin"
        },
        {
          "name": "Type"
        },
        {
          "name": "Subject"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "LastModifiedDate"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "CreatedDate"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "ClosedDate"
        },
        {
          "name": "IsEscalated"
        },
        {
          "name": "Status"
        },
        {
          "name": "CaseNumber"
        }
      ],
      "object": "Case"
    }
  },
  "add_standard_Extract_Case": {
    "action": "computeExpression",
    "parameters": {
      "source": "Extract_Case",
      "computedFields": [
        {
          "name": "CreatedDate",
          "type": "Date",
          "label": "CreatedDate",
          "saqlExpression": "CreatedDate__c",
          "default": ""
        },
        {
          "name": "ClosedDate",
          "type": "Date",
          "label": "Closed Date",
          "saqlExpression": "ClosedDate__c",
          "default": ""
        }
      ],
      "mergeWithSource": true
    }
  },
  "drop_custom_Extract_Case": {
    "action": "sliceDataset",
    "parameters": {
      "source": "add_standard_Extract_Case",
      "mode": "drop",
      "fields": [
        {
          "name": "CreatedDate__c"
        },
        {
          "name": "ClosedDate__c"
        }
      ]
    }
  },
  "Extract_OpportunityStage": {
    "action": "sfdcDigest",
    "parameters": {
      "fields": [
        {
          "name": "IsClosed__c"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "CreatedDate__c"
        },
        {
          "name": "Description__c"
        },
        {
          "name": "ForecastCategory__c"
        },
        {
          "name": "ForecastCategoryName__c"
        },
        {
          "name": "IsActive__c"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "LastModifiedDate"
        },
        {
          "name": "MasterLabel__c"
        },
        {
          "name": "Id"
        },
        {
          "name": "DefaultProbability__c"
        },
        {
          "name": "SortOrder__c"
        },
        {
          "name": "SystemModstamp"
        },
        {
          "name": "IsWon__c"
        }
      ],
      "object": "OpportunityStage__c"
    }
  },
  "rename_OpportunityStageFields": {
    "action": "computeExpression",
    "parameters": {
      "mergeWithSource": false,
      "computedFields": [
        {
          "name": "IsClosed",
          "type": "Text",
          "label": "IsClosed",
          "saqlExpression": "IsClosed__c",
          "default": ""
        },
        {
          "name": "CreatedDate",
          "type": "Date",
          "label": "CreatedDate",
          "saqlExpression": "CreatedDate__c",
          "default": ""
        },
        {
          "name": "Description",
          "type": "Text",
          "label": "Description",
          "saqlExpression": "Description__c",
          "default": ""
        },
        {
          "name": "ForecastCategory",
          "type": "Text",
          "label": "ForecastCategory",
          "saqlExpression": "ForecastCategory__c",
          "default": ""
        },
        {
          "name": "ForecastCategoryName",
          "type": "Text",
          "label": "ForecastCategoryName",
          "saqlExpression": "ForecastCategoryName__c",
          "default": ""
        },
        {
          "name": "IsActive",
          "type": "Text",
          "label": "IsActive",
          "saqlExpression": "IsActive__c",
          "default": ""
        },
        {
          "name": "LastModifiedDate",
          "type": "Date",
          "label": "LastModifiedDate",
          "saqlExpression": "LastModifiedDate",
          "default": ""
        },
        {
          "name": "MasterLabel",
          "type": "Text",
          "label": "MasterLabel",
          "saqlExpression": "MasterLabel__c",
          "default": ""
        },
        {
          "name": "Id",
          "type": "Text",
          "label": "Id",
          "saqlExpression": "Id",
          "default": ""
        },
        {
          "name": "DefaultProbability",
          "type": "Numeric",
          "label": "DefaultProbability",
          "saqlExpression": "DefaultProbability__c",
          "default": ""
        },
        {
          "name": "SortOrder",
          "type": "Numeric",
          "label": "SortOrder",
          "saqlExpression": "SortOrder__c",
          "default": ""
        },
        {
          "name": "SystemModstamp",
          "type": "Date",
          "label": "SystemModstamp",
          "saqlExpression": "SystemModstamp",
          "default": ""
        },
        {
          "name": "IsWon",
          "type": "Text",
          "label": "IsWon",
          "saqlExpression": "IsWon__c",
          "default": ""
        }
      ],
      "source": "Extract_OpportunityStage"
    }
  },
  "Join_OpportunityStage_Previous_with_Opp": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Join_OpportunityStage_Previous",
      "left_key": [
        "OpportunityId"
      ],
      "right_select": [
        "Name",
        "Type",
        "IsWon",
        "IsClosed",
        "OwnerId",
        "AccountId",
        "CloseDate",
        "StageName",
        "LeadSource",
        "ForecastCategoryName",
        "Account.Name",
        "Account.Type",
        "Account.Industry",
        "Account.AccountSource",
        "Account.BillingState",
        "Account.BillingCountry",
        "Account.OwnerId",
        "Account.Owner.Name",
        "Owner.Name",
        "Owner.UserManager.Name",
        "Owner.UserManagerNames",
        "Owner.UserManager.UniqueUserName",
        "Owner.UniqueUserName",
        "Owner.Role.RoleNames",
        "Owner.Role.Name",
        "Owner.Role.DeveloperName",
        "Owner.Role.Roles",
        "Owner.Role.RolePath",
        "Owner.Role.ParentRoleId",
        "Owner.Role.ParentRole.Name",
        "Owner.Role.ParentRole.DeveloperName",
        "RecordTypeId",
        "RecordType.Name"
      ],
      "right": "Join_OpportunityOwner",
      "relationship": "Opportunity"
    }
  },
  "Flatten_UserManager": {
    "schema": {
      "objects": [
        {
          "label": "Flatten_UserManager",
          "fields": [
            {
              "name": "UserManagerNames",
              "label": "UserManagerNames",
              "isSystemField": false
            },
            {
              "name": "ManagerNamesPath",
              "label": "ManagerNamesPath",
              "isSystemField": false
            }
          ]
        }
      ]
    },
    "action": "flatten",
    "parameters": {
      "include_self_id": true,
      "self_field": "UniqueUserName",
      "multi_field": "UserManagerNames",
      "parent_field": "UserManager.UniqueUserName",
      "path_field": "ManagerNamesPath",
      "source": "Join_User_Manager"
    }
  },
  "Join_OpportunityStage_Previous_with_Opp_Amount": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Join_OpportunityStage_Previous_with_Opp",
      "left_key": [
        "OpportunityId"
      ],
      "right_select": [
        "Amount"
      ],
      "right": "Extract_OpportunityAmount",
      "relationship": "Opportunity"
    }
  },
  "Register_PlainQuota": {
    "action": "sfdcRegister",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "name": "Quota",
      "alias": "<plain_quota>",
      "source": "Extract_Quota",
      "folderid": "<folderId>"
    }
  },
  "Join_OpportunityLineItemPricebookEntryProduct": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Join_OpportunityLineItemPricebookEntry",
      "left_key": [
        "Pricebook.Product2Id"
      ],
      "right_select": [
        "ProductCode",
        "Name",
        "Family"
      ],
      "right": "Extract_Product",
      "relationship": "Product"
    }
  },
  "Compute_AdditionalFieldsForLead": {
    "action": "computeExpression",
    "parameters": {
      "source": "Join_LeadOwnerOpportunityAccount",
      "computedFields": [
        {
          "defaultValue": "0",
          "precision": 18,
          "name": "LeadAge",
          "saqlExpression": "case when ('IsConverted' == \"false\") then daysBetween(toDate(CreatedDate_sec_epoch), now())  else daysBetween(toDate(ConvertedDate_day_epoch), toDate(CreatedDate_day_epoch))  end",
          "scale": 2,
          "label": "Lead Age in Days",
          "type": "Numeric"
        },
        {
          "defaultValue": "0",
          "precision": 18,
          "name": "OpportunityAge",
          "saqlExpression": "case when ('ConvertedOpportunity.Name' is null) then 0 when ('ConvertedOpportunity.IsClosed' == \"false\") then ('CurrentDate_sec_epoch' - 'CreatedDate_sec_epoch')/86400  else ('ConvertedOpportunity.CloseDate_sec_epoch' - 'CreatedDate_sec_epoch')/86400 end",
          "scale": 2,
          "label": "Total Opportunity Age",
          "type": "Numeric"
        }
      ],
      "mergeWithSource": true
    }
  },
  "Extract_Queue": {
    "action": "sfdcDigest",
    "parameters": {
      "fields": [
        {
          "name": "Id"
        },
        {
          "name": "Name"
        },
        {
          "name": "Type"
        }
      ],
      "complexFilterConditions": "Type = 'Queue'",
      "object": "Group"
    }
  },
  "Register_OpportunityProducts": {
    "action": "sfdcRegister",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "rowLevelSecurityFilter": "'Opportunity.Owner.Role.Roles' == \"$User.UserRoleId\" || 'Opportunity.OwnerId' == \"$User.Id\" || 'Opportunity.Account.OwnerId' == \"$User.Id\"",
      "name": "Oppty Products",
      "alias": "<opportunity_products>",
      "source": "Filter_Opportunity_Products",
      "folderid": "<folderId>"
    }
  },
  "Extract_Lead": {
    "action": "sfdcDigest",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "fields": [
        {
          "name": "Id"
        },
        {
          "name": "Name"
        },
        {
          "name": "OwnerId"
        },
        {
          "defaultValue": "N/A",
          "name": "Company"
        },
        {
          "name": "ConvertedAccountId"
        },
        {
          "name": "ConvertedContactId"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "ConvertedDate__c"
        },
        {
          "name": "ConvertedOpportunityId"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "CreatedDate__c"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "LastModifiedDate"
        },
        {
          "name": "IsConverted"
        },
        {
          "name": "IsUnreadByOwner"
        },
        {
          "defaultValue": "N/A",
          "name": "Status"
        },
        {
          "defaultValue": "N/A",
          "name": "LeadSource"
        },
        {
          "defaultValue": "N/A",
          "name": "Rating"
        },
        {
          "defaultValue": "N/A",
          "name": "Industry"
        },
        {
          "defaultValue": "N/A",
          "name": "Country"
        }
      ],
      "object": "Lead"
    }
  },
  "add_standard_Extract_Lead": {
    "action": "computeExpression",
    "parameters": {
      "source": "Extract_Lead",
      "computedFields": [
        {
          "name": "CreatedDate",
          "type": "Date",
          "label": "CreatedDate",
          "saqlExpression": "CreatedDate__c",
          "default": ""
        },
        {
          "name": "ConvertedDate",
          "type": "Date",
          "label": "Converted Date",
          "saqlExpression": "ConvertedDate__c",
          "default": ""
        }
      ],
      "mergeWithSource": true
    }
  },
  "drop_custom_Extract_Lead": {
    "action": "sliceDataset",
    "parameters": {
      "source": "add_standard_Extract_Lead",
      "mode": "drop",
      "fields": [
        {
          "name": "CreatedDate__c"
        },
        {
          "name": "ConvertedDate__c"
        }
      ]
    }
  }
  "Append_LineItems": {
    "action": "append",
    "parameters": {
      "sources": [
        "Extract_OpportunityLineItem",
        "Compute_Opportunities_No_Products_Id"
      ]
    }
  },
  "Register_UserManager": {
    "action": "sfdcRegister",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "rowLevelSecurityFilter": "'Role.Roles' == \"$User.UserRoleId\" || 'Id' == \"$User.Id\"",
      "name": "Users",
      "alias": "<user>",
      "source": "User_with_Roles",
      "folderid": "<folderId>"
    }
  },
  "Join_OpportunityStage": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "MasterLabel"
      ],
      "left": "Add_Fields_to_OpportunityHistory",
      "left_key": [
        "StageName"
      ],
      "right_select": [
        "IsClosed",
        "IsWon"
      ],
      "right": "rename_OpportunityStageFields",
      "relationship": "Stage"
    }
  },
  "Join_ActivityOwner_Product": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "OpportunityId"
      ],
      "left": "Join_ActivityOwner",
      "left_key": [
        "WhatId"
      ],
      "right_select": [
        "Product.Family",
        "Product.Name"
      ],
      "right": "Join_OpportunityOpportunityLineItemPricebookEntryProduct",
      "relationship": "Opportunity",
      "operation": "LookupMultiValue"
    }
  },
  "Register_Activity": {
    "action": "sfdcRegister",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "rowLevelSecurityFilter": "'Owner.Role.Roles' == \"$User.UserRoleId\" || 'OwnerId' == \"$User.Id\" || 'Opportunity.Account.OwnerId' == \"$User.Id\"",
      "name": "Activities",
      "alias": "<activity>",
      "source": "Filter_Activity",
      "folderid": "<folderId>"
    }
  },
  "Join_ActivityOwner_Product_Opp": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Join_ActivityOwner_Product",
      "left_key": [
        "WhatId"
      ],
      "right_select": [
        "Id",
        "Name",
        "Type",
        "OwnerId",
        "IsWon",
        "IsClosed",
        "AccountId",
        "CloseDate",
        "StageName",
        "CreatedDate",
        "LeadSource",
        "ForecastCategoryName",
        "Account.Name",
        "Account.Type",
        "Account.Industry",
        "Account.AccountSource",
        "Account.BillingCountry",
        "Account.BillingState",
        "Account.OwnerId",
        "RecordTypeId",
        "RecordType.Name",
        "OpportunityAge",
        "DaysSinceLastActivity"
      ],
      "right": "Join_OpportunityOwner",
      "relationship": "Opportunity"
    }
  },
  "Calculate_Current_Stage_Duration": {
    "action": "computeExpression",
    "parameters": {
      "source": "Filter_Out_Last_Stage_Updates",
      "mergeWithSource": true,
      "computedFields": [
        {
          "precision": 18,
          "name": "Duration_Seconds",
          "saqlExpression": "date_diff(\"second\",toDate('ValidFromDate',\"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\"), now())",
          "scale": 0,
          "label": "Duration",
          "type": "Numeric"
        }
      ]
    }
  },
  "Register_UserRole": {
    "action": "sfdcRegister",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "name": "Roles",
      "alias": "<user_role>",
      "source": "Flatten_ParentName",
      "folderid": "<folderId>"
    }
  },
  "compute_CurrentDateForCase": {
    "action": "computeExpression",
    "parameters": {
      "source": "drop_custom_Extract_Case",
      "computedFields": [
        {
          "format": "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'",
          "name": "CurrentDate",
          "saqlExpression": "now()",
          "label": "CurrentDate",
          "type": "Date"
        }
      ],
      "mergeWithSource": true
    }
  },
  "Augment_ParentName": {
    "_comment": "get parent role's rolename",
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Flatten_UserRole",
      "left_key": [
        "ParentRoleId"
      ],
      "right_select": [
        "Name",
        "DeveloperName",
        "ParentRoleId"
      ],
      "right": "Extract_UserRole",
      "relationship": "ParentRole"
    }
  },
  "Create_IsLastStageUpdate_Field": {
    "action": "computeExpression",
    "parameters": {
      "source": "Find_Last_Stage_Updates",
      "mergeWithSource": true,
      "computedFields": [
        {
          "name": "IsLastStageUpdate",
          "saqlExpression": "case when 'LastStageUpdate_Id' == 'Id' then \"1\" else \"0\" end",
          "label": "IsLastStageUpdate",
          "type": "Text"
        }
      ]
    }
  },
  "Join_OpportunityOpportunityStage": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "MasterLabel"
      ],
      "left": "Add_Fields_To_Opportunity",
      "left_key": [
        "StageName"
      ],
      "right_select": [
        "SortOrder",
        "DefaultProbability"
      ],
      "right": "rename_OpportunityStageFields",
      "relationship": "Stage"
    }
  },
  "Extract_OpportunityHistory": {
    "schema": {
      "objects": [
        {
          "label": "OpportunityHistory",
          "fields": [
            {
              "format": "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'",
              "name": "CreatedDate__c",
              "description": "Opportunity Created Date",
              "label": "CreatedDate"
            },
            {
              "name": "Amount__c",
              "description": "Amount",
              "label": "Amount"
            }
          ]
        }
      ]
    },
    "action": "sfdcDigest",
    "parameters": {
      "fields": [
        {
          "name": "Amount__c"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "CloseDate__c"
        },
        {
          "name": "CreatedById"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "CreatedDate__c"
        },
        {
          "name": "ForecastCategory__c"
        },
        {
          "name": "Id"
        },
        {
          "name": "IsDeleted"
        },
        {
          "name": "OpportunityId__c"
        },
        {
          "name": "StageName__c"
        }
      ],
      "object": "OpportunityHistory__c"
    }
  },
  "rename_OpportunityHistoryFields": {
    "action": "computeExpression",
    "parameters": {
      "mergeWithSource": false,
      "computedFields": [
        {
          "name": "Amount",
          "type": "Numeric",
          "label": "Amount",
          "saqlExpression": "Amount__c",
          "default": ""
        },
        {
          "name": "CreatedDate",
          "type": "Date",
          "label": "CreatedDate",
          "saqlExpression": "CreatedDate__c",
          "default": ""
        },
        {
          "name": "CloseDate",
          "type": "Date",
          "label": "CloseDate",
          "saqlExpression": "CloseDate__c",
          "default": ""
        },
        {
          "name": "CreatedById",
          "type": "Text",
          "saqlExpression": "CreatedById",
          "default": ""
        },
        {          
          "name": "ForecastCategory",
          "type": "Text",
          "saqlExpression": "ForecastCategory__c",
          "default": ""
        },
        {
          "name": "Id",
          "type": "Text",
          "saqlExpression": "Id",
          "default": ""
        },
        {
          "name": "IsDeleted",
          "type": "Text",
          "saqlExpression": "IsDeleted"
        },
        {
          "name": "OpportunityId",
          "type": "Text",
          "saqlExpression": "OpportunityId__c",
          "default": ""
        },
        {          
          "name": "StageName",
          "type": "Text",
          "saqlExpression": "StageName__c",
          "default": ""
        }
      ],
      "source": "Extract_OpportunityHistory"
    }
  },
  "Extract_OpportunityLineItem": {
    "action": "sfdcDigest",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "fields": [
        {
          "name": "OpportunityId"
        },
        {
          "name": "ProductCode"
        },
        {
          "name": "ListPrice"
        },
        {
          "name": "Quantity"
        },
        {
          "name": "TotalPrice"
        },
        {
          "name": "PricebookEntryId"
        }
      ],
      "object": "OpportunityLineItem"
    }
  },
  "Filter_Pipeline_Trending": {
    "action": "filter",
    "parameters": {
      "filter": "CustomFilter:EQ:true",
      "source": "Pipeline_Trending_Custom_Filter_Flag"
    }
  },
  "Filter_Opportunity_Products": {
    "action": "filter",
    "parameters": {
      "filter": "CustomFilter:EQ:true",
      "source": "Opportunity_Products_Custom_Filter_Flag"
    }
  },
  "Register_Pipeline_Trending": {
    "action": "sfdcRegister",
    "parameters": {
      "rowLevelSecurityFilter": "'Opportunity.Owner.Role.Roles' == \"$User.UserRoleId\" || 'Opportunity.OwnerId' == \"$User.Id\" || 'Opportunity.Account.OwnerId' == \"$User.Id\"",
      "name": "Pipeline Trending",
      "alias": "<pipeline_trending>",
      "source": "Filter_Pipeline_Trending",
      "folderid": "<folderId>"
    }
  },
  "Opportunities_No_Products": {
    "action": "filter",
    "parameters": {
      "filter": "HasOpportunityLineItem:EQ:false",
      "source": "Add_Fields_To_Opportunity"
    }
  },
  "Filter_Out_Last_Stage_Updates": {
    "action": "filter",
    "parameters": {
      "filter": "IsLastStageUpdate:EQ:1",
      "source": "Create_IsLastStageUpdate_Field"
    }
  },
  "Join_ActivityOwner": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Append_TaskEvent",
      "left_key": [
        "OwnerId"
      ],
      "right_select": [
        "Name",
        "Username",
        "UserRoleId",
        "UserManager.Name",
        "UserManagerNames",
        "UniqueUserName",
        "UserManager.UniqueUserName",
        "Role.Name",
        "Role.DeveloperName",
        "Role.Roles",
        "Role.RolePath",
        "Role.ParentRoleId",
        "Role.ParentRole.Name",
        "Role.ParentRole.DeveloperName",
        "Role.RoleNames",
        "Role.RoleNamesPath"
      ],
      "right": "User_with_Roles",
      "relationship": "Owner"
    }
  },
  "Filter_Out_Stage_Updates": {
    "action": "filter",
    "parameters": {
      "filter": "Stage_isUpdated:EQ:1",
      "source": "Add_Fields_to_OpportunityHistory"
    }
  },
  "Discount_Field": {
    "action": "computeExpression",
    "parameters": {
      "source": "Append_LineItems",
      "mergeWithSource": true,
      "computedFields": [
        {
          "precision": 7,
          "name": "Discount_Percent",
          "saqlExpression": "1-(('TotalPrice')/('ListPrice' * 'Quantity'))",
          "scale": 6,
          "type": "Numeric"
        }
      ]
    }
  },
  "Filter_Opportunity": {
    "action": "filter",
    "parameters": {
      "filter": "CustomFilter:EQ:true",
      "source": "Opportunity_Custom_Filter_Flag"
    }
  },
  "Register_Opportunity": {
    "action": "sfdcRegister",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "rowLevelSecurityFilter": "'Owner.Role.Roles' == \"$User.UserRoleId\" || 'OwnerId' == \"$User.Id\" || 'Account.OwnerId' == \"$User.Id\"",
      "name": "Opportunities",
      "alias": "<opportunity>",
      "source": "Filter_Opportunity",
      "folderid": "<folderId>"
    }
  },
  "Filter_Activity": {
    "action": "filter",
    "parameters": {
      "filter": "CustomFilter:EQ:true",
      "source": "Activity_Custom_Filter_Flag"
    }
  },
  "Join_LeadQueue": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Join_LeadOwner",
      "left_key": [
        "OwnerId"
      ],
      "right_select": [
        "Name",
        "Type"
      ],
      "right": "Extract_Queue",
      "relationship": "Queue"
    }
  },
  "Compute_Manager_Unique": {
    "action": "computeExpression",
    "parameters": {
      "source": "Compute_Unique_Name",
      "mergeWithSource": true,
      "computedFields": [
        {
          "name": "UniqueUserName",
          "saqlExpression": "case when isDuplicate is null then 'Name' else 'Name' + \" (\" +'Username'+ \")\" end",
          "type": "Text"
        }
      ]
    }
  },
  "Join_OpportunityLineItemPricebookEntry": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Discount_Field",
      "left_key": [
        "PricebookEntryId"
      ],
      "right_select": [
        "Product2Id"
      ],
      "right": "Extract_PricebookEntry",
      "relationship": "Pricebook"
    }
  },
  "Extract_Task": {
    "action": "sfdcDigest",
    "parameters": {
      "fields": [
        {
          "name": "Id"
        },
        {
          "name": "CallDurationInSeconds"
        },
        {
          "name": "CallDisposition"
        },
        {
          "name": "CallType"
        },
        {
          "name": "OwnerId"
        },
        {
          "name": "Status"
        },
        {
          "name": "Priority"
        },
        {
          "name": "IsClosed"
        },
        {
          "name": "TaskSubtype"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "CreatedDate__c"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "ActivityDate"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "LastModifiedDate"
        },
        {
          "name": "Subject"
        },
        {
          "name": "WhatId"
        },
        {
          "name": "AccountId"
        }
      ],
      "object": "Task"
    }
  },
  "add_standard_Extract_Task": {
    "action": "computeExpression",
    "parameters": {
      "source": "Extract_Task",
      "computedFields": [
        {
          "name": "CreatedDate",
          "type": "Date",
          "label": "CreatedDate",
          "saqlExpression": "CreatedDate__c",
          "default": ""
        }
      ],
      "mergeWithSource": true
    }
  },
  "drop_custom_Extract_Task": {
    "action": "sliceDataset",
    "parameters": {
      "source": "add_standard_Extract_Task",
      "mode": "drop",
      "fields": [
        {
          "name": "CreatedDate__c"
        }
      ]
    }
  },
  "Join_AccountOwner": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Extract_Account",
      "left_key": [
        "OwnerId"
      ],
      "right_select": [
        "Name",
        "Username",
        "UserRoleId",
        "UserManager.Name",
        "UserManagerNames",
        "UniqueUserName",
        "UserManager.UniqueUserName",
        "Role.Name",
        "Role.DeveloperName",
        "Role.Roles",
        "Role.RolePath",
        "Role.ParentRoleId",
        "Role.ParentRole.Name",
        "Role.ParentRole.DeveloperName",
        "Role.RoleNames",
        "Role.RoleNamesPath"
      ],
      "right": "User_with_Roles",
      "relationship": "Owner"
    }
  },
  "Join_Time_In_Current_Stage_to_Opportunity": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "OpportunityId"
      ],
      "left": "Join_OpportunityRecordType",
      "left_key": [
        "Id"
      ],
      "right_select": [
        "Duration_Seconds"
      ],
      "right": "Calculate_Current_Stage_Duration",
      "relationship": "Time_In_Current_Stage"
    }
  },
  "Filter_WonOppty": {
    "action": "filter",
    "parameters": {
      "filter": "IsWon:EQ:true",
      "source": "Join_OpportunityAccount"
    }
  },
  "Append_TaskEvent": {
    "action": "append",
    "parameters": {
      "sources": [
        "Add_Fields_To_Task",
        "Add_Fields_To_Event"
      ]
    }
  },
  "Add_Fields_to_OpportunityHistory": {
    "action": "computeExpression",
    "parameters": {
      "source": "Compute_Historical_Trending_Fields",
      "mergeWithSource": true,
      "computedFields": [
        {
          "defaultValue": "\"1\"",
          "name": "Stage_isUpdated",
          "saqlExpression": "case when 'StageName' == 'StageNamePrev' then \"0\" else \"1\" end",
          "type": "Text"
        },
        {
          "defaultValue": "\"1\"",
          "name": "CloseDate_isUpdated",
          "saqlExpression": "case when 'CloseDatePrev' == 'CloseDate' then \"0\" else \"1\" end",
          "type": "Text"
        },
        {
          "defaultValue": "\"1\"",
          "name": "Amount_isUpdated",
          "saqlExpression": "case when 'AmountPrev' == 'Amount' then \"0\" else \"1\" end",
          "type": "Text"
        },
        {
          "name": "IsLastUpdate",
          "saqlExpression": "case when 'ValidToDate' == \"3000-01-01T00:00:00.000Z\" then \"1\" else \"0\" end",
          "label": "IsLastUpdate",
          "type": "Text"
        },
        {
          "precision": 8,
          "name": "IsPushed",
          "saqlExpression": "case when ('CloseDatePrev' != \"1970-1-1\") && ('CloseDatePrev' < 'CloseDate') then 1 else 0 end",
          "scale": 0,
          "type": "Numeric"
        },
        {
          "precision": 8,
          "name": "IsPulled",
          "saqlExpression": "case when ('CloseDatePrev' != \"1970-1-1\") && ('CloseDatePrev' > 'CloseDate') then 1 else 0 end",
          "scale": 0,
          "type": "Numeric"
        },
        {
          "precision": 18,
          "name": "Duration",
          "saqlExpression": "case when 'ValidToDate' == \"3000-01-01T00:00:00.000Z\" then     date_diff(\"second\",toDate('ValidFromDate',\"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\"), now())     else     date_diff(\"second\",toDate('ValidFromDate',\"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\"), toDate('ValidToDate',\"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\"))     end",
          "scale": 0,
          "label": "Duration",
          "type": "Numeric"
        }
      ]
    }
  },
  "Register_Lead": {
    "action": "sfdcRegister",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "rowLevelSecurityFilter": "'IsConverted' == \"false\" || 'ConvertedOpportunity.Owner.Role.Roles' == \"$User.UserRoleId\" || 'ConvertedOpportunity.OwnerId' == \"$User.Id\" || 'ConvertedAccount.OwnerId' == \"$User.Id\"",
      "name": "Leads",
      "alias": "<lead>",
      "source": "Compute_AdditionalFieldsForLead",
      "folderid": "<folderId>"
    }
  },
  "Register_Account": {
    "action": "sfdcRegister",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "rowLevelSecurityFilter": "'Owner.Role.Roles' == \"$User.UserRoleId\" || 'OwnerId' == \"$User.Id\"",
      "name": "Accounts",
      "alias": "<account>",
      "source": "Filter_Account",
      "folderid": "<folderId>"
    }
  },
  "Join_OpportunityOwner": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Join_OpportunityAccount",
      "left_key": [
        "OwnerId"
      ],
      "right_select": [
        "Name",
        "Username",
        "UserRoleId",
        "UserManager.Name",
        "UserManagerNames",
        "UniqueUserName",
        "UserManager.UniqueUserName",
        "Role.Name",
        "Role.DeveloperName",
        "Role.Roles",
        "Role.RolePath",
        "Role.ParentRoleId",
        "Role.ParentRole.Name",
        "Role.ParentRole.DeveloperName",
        "Role.RoleNames",
        "Role.RoleNamesPath"
      ],
      "right": "User_with_Roles",
      "relationship": "Owner"
    }
  },
  "Join_CaseAccount_Oppty": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "AccountId"
      ],
      "left": "Join_CaseAccount",
      "left_key": [
        "AccountId"
      ],
      "right_select": [
        "Amount"
      ],
      "right": "Filter_WonOppty",
      "relationship": "Opportunity",
      "operation": "LookupMultiValue"
    }
  },
  "Compute_Unique_Name": {
    "action": "computeRelative",
    "parameters": {
      "partitionBy": [
        "Name"
      ],
      "orderBy": [
        {
          "name": "Id",
          "direction": "asc"
        }
      ],
      "source": "Filter_User",
      "computedFields": [
        {
          "expression": {
            "sourceField": "Id",
            "default": null,
            "offset": "next()"
          },
          "name": "isDuplicate",
          "description": "isDuplicate",
          "label": "isDuplicate"
        }
      ]
    }
  },
  "Find_Last_Stage_Updates": {
    "action": "computeRelative",
    "parameters": {
      "partitionBy": [
        "OpportunityId"
      ],
      "orderBy": [
        {
          "name": "CreatedDate",
          "direction": "desc"
        }
      ],
      "source": "Filter_Out_Stage_Updates",
      "computedFields": [
        {
          "expression": {
            "sourceField": "Id",
            "default": "current()",
            "offset": "first()"
          },
          "name": "LastStageUpdate_Id",
          "description": "Final Stage Change Id",
          "label": "LastStageUpdate_Id"
        }
      ]
    }
  },
  "Add_Fields_To_Event": {
    "action": "computeExpression",
    "parameters": {
      "source": "drop_custom_Extract_Event",
      "computedFields": [
        {
          "name": "CallDisposition",
          "saqlExpression": "\"Event\"",
          "label": "CallDisposition",
          "type": "Text"
        },
        {
          "name": "CallType",
          "saqlExpression": "\"Event\"",
          "label": "CallType",
          "type": "Text"
        },
        {
          "name": "Status",
          "saqlExpression": "\"Event\"",
          "label": "Status",
          "type": "Text"
        },
        {
          "name": "Priority",
          "saqlExpression": "\"Event\"",
          "label": "Priority",
          "type": "Text"
        },
        {
          "name": "TaskSubtype",
          "saqlExpression": "EventSubtype",
          "label": "TaskSubtype",
          "type": "Text"
        },
        {
          "defaultValue": "0",
          "precision": 8,
          "name": "CallDurationInSeconds",
          "saqlExpression": "0",
          "scale": 0,
          "label": "CallDurationInSeconds",
          "type": "Numeric"
        },
        {
          "name": "IsClosed",
          "saqlExpression": "case when daysBetween(toDate(ActivityDate, \"yyyy-MM-dd\"), now()) >= 0 then \"true\" else \"false\" end",
          "label": "IsClosed",
          "type": "Text"
        }
      ],
      "mergeWithSource": true
    }
  },
  "Join_ActivityOwner_Product_Opp_User_Account": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Join_ActivityOwner_Product_Opp_User",
      "left_key": [
        "AccountId"
      ],
      "right_select": [
        "Name",
        "Type",
        "Industry",
        "BillingCountry",
        "BillingState",
        "AccountSource",
        "NumberOfEmployees",
        "AnnualRevenue",
        "OwnerId",
        "Owner.Name",
        "Owner.UserManager.Name",
        "Owner.UserManagerNames",
        "Owner.UserManager.UniqueUserName",
        "Owner.UniqueUserName",
        "Owner.Role.Name",
        "Owner.Role.Roles",
        "Owner.Role.RolePath",
        "Owner.Role.ParentRoleId"
      ],
      "right": "Join_AccountOwner",
      "relationship": "Account"
    }
  },
  "Account_Custom_Filter_Flag": {
    "action": "computeExpression",
    "parameters": {
      "source": "Join_AccountOwner",
      "mergeWithSource": true,
      "computedFields": [
        {
          "name": "CustomFilter",
          "saqlExpression": "\"true\"",
          "type": "Text"
        }
      ]
    }
  },
  "Join_OpportunityAccount": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Join_Time_In_Current_Stage_to_Opportunity",
      "left_key": [
        "AccountId"
      ],
      "right_select": [
        "Name",
        "Type",
        "Industry",
        "BillingCountry",
        "BillingState",
        "AccountSource",
        "NumberOfEmployees",
        "AnnualRevenue",
        "OwnerId",
        "Owner.Name",
        "Owner.UserManager.Name",
        "Owner.UserManagerNames",
        "Owner.UserManager.UniqueUserName",
        "Owner.UniqueUserName",
        "Owner.Role.Name",
        "Owner.Role.Roles",
        "Owner.Role.RolePath",
        "Owner.Role.ParentRoleId"
      ],
      "right": "Join_AccountOwner",
      "relationship": "Account"
    }
  },
  "Register_QuotaWithRoles": {
    "action": "sfdcRegister",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "rowLevelSecurityFilter": "'User.Role.Roles' == \"$User.UserRoleId\" || 'User.Id' == \"$User.Id\"",
      "name": "User Allocation",
      "alias": "<quota>",
      "source": "Join_Quota_User",
      "folderid": "<folderId>"
    }
  },
  "compute_CalculatedCaseDuration": {
    "action": "computeExpression",
    "parameters": {
      "source": "compute_CurrentDateForCase",
      "computedFields": [
        {
          "defaultValue": "0",
          "precision": 18,
          "name": "DurationCalculatedField",
          "saqlExpression": "case  when ('IsClosed' == \"true\") then ('ClosedDate_sec_epoch' - 'CreatedDate_sec_epoch')/86400   else ('CurrentDate_sec_epoch' - 'CreatedDate_sec_epoch')/86400  end",
          "scale": 2,
          "label": "Case Duration",
          "type": "Numeric"
        }
      ],
      "mergeWithSource": true
    }
  },
  "Filter_User": {
    "action": "filter",
    "parameters": {
      "filter": "UserType:EQ:Standard|PowerPartner",
      "source": "Extract_User"
    }
  },
  "Filter_Account": {
    "action": "filter",
    "parameters": {
      "filter": "CustomFilter:EQ:true",
      "source": "Account_Custom_Filter_Flag"
    }
  },
  "Join_OpportunityRecordType": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Join_OpportunityOpportunityStage",
      "left_key": [
        "RecordTypeId"
      ],
      "right_select": [
        "Name"
      ],
      "right": "Extract_RecordTypes",
      "relationship": "RecordType"
    }
  },
  "Opportunity_Custom_Filter_Flag": {
    "action": "computeExpression",
    "parameters": {
      "source": "Join_OpportunityOwner_Product",
      "mergeWithSource": true,
      "computedFields": [
        {
          "name": "CustomFilter",
          "saqlExpression": "\"true\"",
          "type": "Text"
        }
      ]
    }
  },
  "Compute_Opportunities_No_Products": {
    "action": "computeExpression",
    "parameters": {
      "source": "Opportunities_No_Products",
      "computedFields": [
        {
          "name": "OpportunityId",
          "saqlExpression": "Id",
          "label": "OpportunityId",
          "type": "Text"
        },
        {
          "name": "ProductCode",
          "saqlExpression": "\"N/A\"",
          "label": "ProductCode",
          "type": "Text"
        },
        {
          "precision": 18,
          "name": "ListPrice",
          "saqlExpression": "Amount",
          "scale": 2,
          "label": "ListPrice",
          "type": "Numeric"
        },
        {
          "precision": 18,
          "name": "Quantity",
          "saqlExpression": "1",
          "scale": 2,
          "label": "Quantity",
          "type": "Numeric"
        },
        {
          "precision": 18,
          "name": "TotalPrice",
          "saqlExpression": "Amount",
          "scale": 2,
          "label": "Total Price",
          "type": "Numeric"
        },
        {
          "name": "PricebookEntryId",
          "saqlExpression": "Id",
          "label": "PricebookEntryId",
          "type": "Text"
        }
      ],
      "mergeWithSource": false
    }
  },
  "Join_LeadOwnerOpportunityAccount": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Join_LeadOwnerOpportunity",
      "left_key": [
        "ConvertedAccountId"
      ],
      "right_select": [
        "Name",
        "Type",
        "Industry",
        "BillingCountry",
        "BillingState",
        "AccountSource",
        "NumberOfEmployees",
        "AnnualRevenue",
        "OwnerId",
        "Owner.Name",
        "Owner.UserManager.Name",
        "Owner.UserManagerNames",
        "Owner.UserManager.UniqueUserName",
        "Owner.UniqueUserName",
        "Owner.Role.Name",
        "Owner.Role.Roles",
        "Owner.Role.RolePath",
        "Owner.Role.ParentRoleId"
      ],
      "right": "Join_AccountOwner",
      "relationship": "ConvertedAccount"
    }
  },
  "Activity_Custom_Filter_Flag": {
    "action": "computeExpression",
    "parameters": {
      "source": "Join_ActivityOwner_Product_Opp_User_Account",
      "mergeWithSource": true,
      "computedFields": [
        {
          "name": "CustomFilter",
          "saqlExpression": "\"true\"",
          "type": "Text"
        }
      ]
    }
  },
  "Join_OpportunityStage_Previous_with_Opp_Amount_Product": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "OpportunityId"
      ],
      "left": "Join_OpportunityStage_Previous_with_Opp_Amount",
      "left_key": [
        "OpportunityId"
      ],
      "right_select": [
        "Product.Family",
        "Product.Name"
      ],
      "right": "Join_OpportunityOpportunityLineItemPricebookEntryProduct",
      "relationship": "Opportunity",
      "operation": "LookupMultiValue"
    }
  },
  "Compute_Historical_Trending_Fields": {
    "action": "computeRelative",
    "parameters": {
      "partitionBy": [
        "OpportunityId"
      ],
      "orderBy": [
        {
          "name": "CreatedDate",
          "direction": "asc"
        }
      ],
      "source": "rename_OpportunityHistoryFields",
      "computedFields": [
        {
          "expression": {
            "sourceField": "CreatedDate",
            "default": "current()",
            "offset": "first()"
          },
          "name": "OpportunityCreatedDate",
          "description": "Opportunity Created Date",
          "label": "OpportunityCreatedDate"
        },
        {
          "expression": {
            "sourceField": "CreatedDate",
            "default": "3000-01-01T00:00:00.000Z",
            "offset": "next()"
          },
          "name": "ValidToDate",
          "description": "ValidToDate",
          "label": "ValidToDate"
        },
        {
          "expression": {
            "sourceField": "CreatedDate",
            "default": "current()",
            "offset": "current()"
          },
          "name": "ValidFromDate",
          "description": "ValidFromDate",
          "label": "ValidFromDate"
        },
        {
          "expression": {
            "sourceField": "Amount",
            "default": "0",
            "offset": "previous()"
          },
          "name": "AmountPrev",
          "description": "AmountPrev",
          "label": "AmountPrev"
        },
        {
          "expression": {
            "sourceField": "StageName",
            "default": null,
            "offset": "previous()"
          },
          "name": "StageNamePrev",
          "description": "Previous Stage Name",
          "label": "Prev Stage Name"
        },
        {
          "expression": {
            "sourceField": "ForecastCategory",
            "default": null,
            "offset": "previous()"
          },
          "name": "ForecastCategoryPrev",
          "description": "ForecastCategoryPrev",
          "label": "ForecastCategoryPrev"
        },
        {
          "expression": {
            "sourceField": "CloseDate",
            "default": "1970-01-01",
            "offset": "previous()"
          },
          "name": "CloseDatePrev",
          "description": "Previous Close Date",
          "label": "Prev Close Date"
        },
        {
          "expression": {
            "sourceField": "CreatedDate",
            "default": null,
            "offset": "previous()"
          },
          "name": "CreatedDatePrev",
          "description": "Previous Created Date",
          "label": "Prev CreatedDate"
        }
      ]
    }
  },
  "Extract_RecordTypes": {
    "action": "sfdcDigest",
    "parameters": {
      "fields": [
        {
          "name": "Name"
        },
        {
          "name": "Id"
        }
      ],
      "object": "RecordType"
    }
  },
  "Flatten_ParentName": {
    "schema": {
      "objects": [
        {
          "label": "Flatten_UserRole",
          "fields": [
            {
              "name": "RoleNames",
              "label": "RoleNames",
              "isSystemField": false
            },
            {
              "name": "RoleNamesPath",
              "label": "RoleNamesPath",
              "isSystemField": false
            }
          ]
        }
      ]
    },
    "action": "flatten",
    "parameters": {
      "include_self_id": true,
      "self_field": "DeveloperName",
      "multi_field": "RoleNames",
      "parent_field": "ParentRole.DeveloperName",
      "path_field": "RoleNamesPath",
      "source": "Augment_ParentName"
    }
  },
  "Join_Quota_User": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Username"
      ],
      "left": "Extract_Quota",
      "left_key": [
        "Username"
      ],
      "right_select": [
        "Id",
        "Name",
        "Username",
        "UserRoleId",
        "UserManager.Name",
        "UserManagerNames",
        "UniqueUserName",
        "UserManager.UniqueUserName",
        "Role.Name",
        "Role.DeveloperName",
        "Role.Roles",
        "Role.RolePath",
        "Role.ParentRoleId",
        "Role.ParentRole.Name",
        "Role.ParentRole.DeveloperName",
        "Role.RoleNames",
        "Role.RoleNamesPath"
      ],
      "right": "User_with_Roles",
      "relationship": "User"
    }
  },
  "Extract_Account": {
    "action": "sfdcDigest",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "fields": [
        {
          "name": "Id"
        },
        {
          "name": "Name"
        },
        {
          "name": "OwnerId"
        },
        {
          "name": "NumberOfEmployees"
        },
        {
          "name": "AnnualRevenue"
        },
        {
          "name": "AccountSource"
        },
        {
          "name": "Type"
        },
        {
          "name": "Industry"
        },
        {
          "name": "BillingCountry"
        },
        {
          "name": "BillingState"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "CreatedDate"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "LastModifiedDate"
        }
      ],
      "object": "Account"
    }
  },
  "Compute_Opportunities_No_Products_Id": {
    "action": "computeExpression",
    "parameters": {
      "source": "Compute_Opportunities_No_Products",
      "computedFields": [
        {
          "name": "Id",
          "saqlExpression": "\"N/A\"",
          "label": "Id",
          "type": "Text"
        }
      ],
      "mergeWithSource": true
    }
  },
  "Join_OpportunityOpportunityLineItemPricebookEntryProduct": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Join_OpportunityLineItemPricebookEntryProduct",
      "left_key": [
        "OpportunityId"
      ],
      "right_select": [
        "Name",
        "StageName",
        "CloseDate",
        "IsWon",
        "Type",
        "IsClosed",
        "LeadSource",
        "ForecastCategory",
        "ForecastCategoryName",
        "CreatedDate",
        "AccountId",
        "Account.Name",
        "Account.OwnerId",
        "Account.Type",
        "Account.Industry",
        "Account.BillingCountry",
        "Account.BillingState",
        "Account.AccountSource",
        "Account.NumberOfEmployees",
        "Account.AnnualRevenue",
        "Account.Owner.Name",
        "Account.Owner.Role.Name",
        "Account.Owner.Role.Roles",
        "Account.Owner.Role.RolePath",
        "OwnerId",
        "Owner.Name",
        "Owner.UserManager.Name",
        "Owner.UserManagerNames",
        "Owner.UserManager.UniqueUserName",
        "Owner.UniqueUserName",
        "Owner.Role.Name",
        "Owner.Role.DeveloperName",
        "Owner.Role.Roles",
        "Owner.Role.RolePath",
        "Owner.Role.ParentRoleId",
        "RecordTypeId",
        "RecordType.Name",
        "OpportunityAge",
        "DaysSinceLastActivity"
      ],
      "right": "Join_OpportunityOwner",
      "relationship": "Opportunity"
    }
  },
  "Extract_Quota": {
    "action": "edgemart",
    "parameters": {
      "alias": "<plain_quota>"
    }
  },
  "Compute_Lead_Name_or_Queue": {
    "action": "computeExpression",
    "parameters": {
      "source": "Join_LeadQueue",
      "computedFields": [
        {
          "name": "UserOrQueueName",
          "saqlExpression": "case when 'Owner.Name' is null && !('Queue.Name' is null) then 'Queue.Name' when !('Owner.Name' is null) then 'Owner.Name' else \"N/A\" end",
          "label": "Owner or Queue Name",
          "type": "Text"
        },
        {
          "name": "OwnerType",
          "saqlExpression": "case when 'Owner.Name' is null && !('Queue.Name' is null) then \"Queue\" when !('Owner.Name' is null) then \"User\" else \"N/A\" end",
          "label": "Owner Type",
          "type": "Text"
        }
      ],
      "mergeWithSource": true
    }
  },
  "Add_Fields_To_Task": {
    "action": "computeExpression",
    "parameters": {
      "source": "drop_custom_Extract_Task",
      "computedFields": [
        {
          "name": "EventSubtype",
          "saqlExpression": "TaskSubtype",
          "label": "EventSubtype",
          "type": "Text"
        },
        {
          "defaultValue": "0",
          "precision": 8,
          "name": "DurationInMinutes",
          "saqlExpression": "0",
          "scale": 0,
          "label": "DurationInMinutes",
          "type": "Numeric"
        }
      ],
      "mergeWithSource": true
    }
  },
  "Extract_UserRole": {
    "action": "sfdcDigest",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "fields": [
        {
          "name": "Id"
        },
        {
          "name": "Name"
        },
        {
          "name": "DeveloperName"
        },
        {
          "name": "ParentRoleId"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "LastModifiedDate"
        },
        {
          "name": "LastModifiedById"
        },
        {
          "name": "ForecastUserId"
        },
        {
          "name": "SystemModstamp"
        }
      ],
      "object": "UserRole"
    }
  },
  "User_with_Roles": {
    "_comment": "Get user's role hierarchy",
    "action": "augment",
    "parameters": {
      "right_key": [
        "Id"
      ],
      "left": "Flatten_UserManager",
      "left_key": [
        "UserRoleId"
      ],
      "right_select": [
        "Name",
        "DeveloperName",
        "Roles",
        "RolePath",
        "ParentRoleId",
        "ParentRole.Name",
        "ParentRole.DeveloperName",
        "RoleNames",
        "RoleNamesPath"
      ],
      "right": "Flatten_ParentName",
      "relationship": "Role"
    }
  },
  "Pipeline_Trending_Custom_Filter_Flag": {
    "action": "computeExpression",
    "parameters": {
      "source": "Join_OpportunityStage_Previous_with_Opp_Amount_Product",
      "mergeWithSource": true,
      "computedFields": [
        {
          "name": "CustomFilter",
          "saqlExpression": "\"true\"",
          "type": "Text"
        }
      ]
    }
  },
  "Join_OpportunityOwner_Product": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "OpportunityId"
      ],
      "left": "Join_OpportunityOwner",
      "left_key": [
        "Id"
      ],
      "right_select": [
        "Product.Family",
        "Product.Name"
      ],
      "right": "Join_OpportunityOpportunityLineItemPricebookEntryProduct",
      "relationship": "Product",
      "operation": "LookupMultiValue"
    }
  },
  "Add_Fields_To_Opportunity": {
    "action": "computeExpression",
    "parameters": {
      "source": "drop_custom_Extract_Opportunity",
      "computedFields": [
        {
          "precision": 8,
          "name": "DaysSinceLastActivity",
          "saqlExpression": "case    when LastActivityDate is null      then daysBetween(toDate(substr(LastModifiedDate, 1, 10), \"yyyy-MM-dd\"), now())   when LastModifiedDate > LastActivityDate     then daysBetween(toDate(substr(LastModifiedDate, 1, 10), \"yyyy-MM-dd\"), now())   else daysBetween(toDate(substr(LastActivityDate, 1, 10), \"yyyy-MM-dd\"), now()) end",
          "scale": 0,
          "label": "Days Since Last Activity",
          "type": "Numeric"
        },
        {
          "precision": 8,
          "name": "OpportunityAge",
          "saqlExpression": "case    when IsClosed == \"false\"     then daysBetween(toDate(substr(CreatedDate, 1, 10), \"yyyy-MM-dd\"), now())     else daysBetween(toDate(substr(CreatedDate, 1, 10), \"yyyy-MM-dd\"),toDate(substr(CloseDate, 1, 10), \"yyyy-MM-dd\"))     end",
          "scale": 0,
          "label": "Opportunity Age",
          "type": "Numeric"
        }
      ],
      "mergeWithSource": true
    }
  },
  "Extract_Event": {
    "action": "sfdcDigest",
    "parameters": {
      "fields": [
        {
          "name": "OwnerId"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "CreatedDate__c"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "LastModifiedDate"
        },
        {
          "fiscalMonthOffset": 0,
          "firstDayOfWeek": 0,
          "name": "ActivityDate"
        },
        {
          "name": "Subject"
        },
        {
          "name": "DurationInMinutes"
        },
        {
          "name": "EventSubtype"
        },
        {
          "name": "WhatId"
        },
        {
          "name": "AccountId"
        }
      ],
      "object": "Event"
    }
  },
  "add_standard_Extract_Event": {
    "action": "computeExpression",
    "parameters": {
      "source": "Extract_Event",
      "computedFields": [
        {
          "name": "CreatedDate",
          "type": "Date",
          "label": "CreatedDate",
          "saqlExpression": "CreatedDate__c",
          "default": ""
        }
      ],
      "mergeWithSource": true
    }
  },
  "drop_custom_Extract_Event": {
    "action": "sliceDataset",
    "parameters": {
      "source": "add_standard_Extract_Event",
      "mode": "drop",
      "fields": [
        {
          "name": "CreatedDate__c"
        }
      ]
    }
  },
  "Flatten_UserRole": {
    "schema": {
      "objects": [
        {
          "label": "Flatten_UserRole",
          "fields": [
            {
              "name": "Roles",
              "label": "Roles",
              "isSystemField": false
            },
            {
              "name": "RolePath",
              "label": "RolePath",
              "isSystemField": false
            }
          ]
        }
      ]
    },
    "action": "flatten",
    "parameters": {
      "self_field": "Id",
      "multi_field": "Roles",
      "parent_field": "ParentRoleId",
      "path_field": "RolePath",
      "source": "Extract_UserRole"
    }
  },
  "Opportunity_Products_Custom_Filter_Flag": {
    "action": "computeExpression",
    "parameters": {
      "source": "Join_OpportunityOpportunityLineItemPricebookEntryProduct",
      "mergeWithSource": true,
      "computedFields": [
        {
          "name": "CustomFilter",
          "saqlExpression": "\"true\"",
          "type": "Text"
        }
      ]
    }
  },
  "Register_Case": {
    "action": "sfdcRegister",
    "parameters": {
      "SFDCtoken": "SFDCtoken",
      "rowLevelSecurityFilter": "",
      "name": "Cases",
      "alias": "<case>",
      "source": "Join_CaseAccount_Oppty",
      "folderid": "<folderId>"
    }
  },
  "Join_OpportunityStage_Previous": {
    "action": "augment",
    "parameters": {
      "right_key": [
        "MasterLabel"
      ],
      "left": "Join_OpportunityStage",
      "left_key": [
        "StageNamePrev"
      ],
      "right_select": [
        "IsClosed",
        "IsWon"
      ],
      "right": "rename_OpportunityStageFields",
      "relationship": "StagePrev"
    }
  }
}
